{
  "name": "coremedia_tomcat",
  "description": "Installs Apache Tomcat and installs and configures Tomcat based services instances",
  "long_description": "# Description\n\nThis is a library cookbook. It provides a LWRP to install Apache Tomcat and install a service init script.\nIt also provides a LWRP to install a war artifact from a maven repository and optionally to update it with a context file.\nBoth LWRPs are complemented with two definitions, one to create a service user and group and one definition to glue tomcat, webapp\nand a service resource together with a functioning lifecycle to stop the service, update the `doc_base` of the webapp and then restart\nthe service.\n\nTo accomplish the lifecycle above, the lifecycle definition gets the tomcat and the webapp resources as parameters. This can\n be done in a handy way, by creating variables and let them reference the resources.\n\n### Example\n\n```ruby\n\nsimple_home = '/opt/simple'\n\n# create the service user\ncoremedia_tomcat_service_user 'simple' do\n  home simple_home\n  group 'tomcat'\nend\n\ntomcat = coremedia_tomcat 'simple' do\n  path simple_home\n  version '7.0.63'\n  user 'simple'\n  group 'tomcat'\n  port_prefix 401\nend\n\n# unexploded webapp\nwebapp_unexploded = coremedia_tomcat_webapp \"simple\" do\n  group_id 'org.codehaus.cargo'\n  artifact_id 'simple-war'\n  version '1.4.16'\n  path \"#{simple_home}/simple.war\"\n  owner tomcat.user\n  group tomcat.group\n  # context defaults to the resource name\n  #context 'simple'\nend\n\n# exploded webapp, the war will be placed at /opt/simple/simple-exploded.war\nwebapp_exploded = coremedia_tomcat_webapp \"simple-exploded\" do\n  group_id 'org.codehaus.cargo'\n  artifact_id 'simple-war'\n  version '1.4.16'\n  path \"#{simple_home}/simple-exploded\"\n  owner tomcat.user\n  group tomcat.group\nend\n\n# add a file to the exploded dir and update the webapp\ntemplate \"#{webapp_exploded.path}/index.html\" do\n  source 'my-index.html.erb'\n  owner tomcat.user\n  group tomcat.group\n  variables :hello => \"hello world from webapp #{webapp_exploded.artifact_id} with version #{webapp_exploded.version}\"\n  notifies :update, webapp_exploded, :immediately\nend\n\n# add more webapps here\n\n# now lets close the lifecycle\ncoremedia_tomcat_service_lifecyle \"simple\" do\n  # if the name of the definition equals the tomcat resources name the attribute can be omitted.\n  # tomcat tomcat\n  webapps [webapp_unexploded, webapp_exploded]\nend\n```\n\n### Context files\n\nContext files can either be placed as the default file in the `conf` directory or within a webapps `META-INF` directory if a\nwebapp is deployed as as an exploded path. In both cases the same default template is being used. The configuration hash can look like the\nfollowing example:\n\n```ruby\n{\n  :display_name => 'myapp',                 # only allowed on webapp level\n  :session_cookie_name => 'CM_SESSION_ID'\n  :env_entries => {\n    'toggle' => {                           # the name of the entry\n      'description' => 'this does nothing', # description is optional\n      'value' => 'false',                   # required to be set\n      'type'  => 'java.lang.Boolean'        # defaults to java.lang.String\n    }\n  },\n  :listener => {\n    'my_listener' => {\n      'className' => 'my.Klazz',\n      'propertyname' => 'value'\n    }\n  },\n  :resource_links => {\n    'orb_link' => {\n      'name' => 'ORB',\n      'global' => 'ORB',\n      'type' => 'org.omg.CORBA.ORB'\n    }\n  }\n}\n```\n# Requirements\n\n## Platform:\n\n* redhat\n* centos\n\n## Cookbooks:\n\n* coremedia_maven (~> 2.0)\n* ulimit (~> 0.3)\n\n# Attributes\n\n*No attributes defined*\n\n# Recipes\n\n*No recipes defined*\n\n# Definitions\n\n* [coremedia_tomcat_service_lifecycle](#coremedia_tomcat_service_lifecycle) - This definition controls the lifecycle of webapps and its enclosing service.\n* [coremedia_tomcat_service_user](#coremedia_tomcat_service_user) - This definition creates the service user.\n\n## coremedia_tomcat_service_lifecycle\n\nThis definition controls the lifecycle of webapps and its enclosing service. By injecting the tomcat resource as well as\nall webapp resources as parameters into this definition. This definition can encapsulate the logic, when to restart the service\nand when to redeploy the webapps. See description of the webapp LWRP for more details about how to notify changes.\n\n### Parameters\n\n- tomcat: A `coremedia_tomcat` resource.  If not set, the definition will look for a `coremedia_tomcat` resource with the same name as the definition..\n- webapps: An array of `coremedia_tomcat_webapp` resources. If not set, the definition will look for a `coremedia_tomcat_webapp` resource with the same name as the definition..\n- undeploy_unmanaged: Undeploy unmanaged webapps.. Defaults to: true\n- start_service: Set this to false to skip service start.. Defaults to: true\n- enable_service: Set this to false to not enable the service.. Defaults to: true\n\n### Examples\n\n```ruby\ntomcat_resource = coremedia_tomcat 'solr' do\n...\nend\n\nsolr_webapp_resource = coremedia_tomcat_webapp 'solr do\n...\nend\n\ncoremedia_tomcat_service_lifecycle 'solr' do\n  tomcat tomcat_resource\n  webapps [solr_webapp_resource]\nend\n```\n## coremedia_tomcat_service_user\n\nThis definition creates the service user.\n\n### Parameters\n\n- : process_limit.\n- filehandle_limit: . Defaults to: 25000\n- process_limit: . Defaults to: 5000\n\n### Examples\n\n```ruby\ncoremedia_tomcat_service_user 'solr' do\n  user  'solr'\n  group 'tomcat'\n  home '/opt/coremedia/solr'\n  filehandle_limit 25_000\n  process_limit 5000\nend\n```\n# Resources\n\n* [coremedia_tomcat](#coremedia_tomcat) - Installs Apache Tomcat configures it and integrates it in the native service registry.\n* [coremedia_tomcat_webapp](#coremedia_tomcat_webapp) - Installs a webapp and optionally adds a `META-INF/context.xml`.\n\n## coremedia_tomcat\n\n\nInstalls Apache Tomcat configures it and integrates it in the native service registry.\nThe layout will be:\n\n```\n<path>\n    |-service-hooks\n    |-apache-tomcat-<version>\n    |-current   -> <path>/apache-tomcat-<version>\n    |-server-lib\n    `-common-lib\n\n/etc/init.d/<name>  -> <path>/current/bin/init.sh\n```\n### Actions\n\n- install: Install tomcat. Default action.\n- update: Sets the `updated_by_last_action` flag of this resource to `true`. Use this to notify a service restart.\n\n### Attribute Parameters\n\n- path: The installation path of the tomcat service dir.\n- source: The url of the tomcat zip archive. If you set this, you need to set a matching `version` attribute to determine the tomcat dir inside the archive. Defaults to <code>nil</code>.\n- source_checksum: The SHA-256 checksum of the tomcat zip artifact. Defaults to <code>nil</code>.\n- version: The version of tomcat.\n- start_levels: The start_levels attribute for SystemV init script. Defaults to <code>2345</code>.\n- start_priority: The start priority attribute for SystemV init script. Defaults to <code>88</code>.\n- user: The owner of all files and the user to start the service with. Defaults to <code>\"root\"</code>.\n- group: The group of all files. Defaults to <code>\"root\"</code>.\n- startup_wait: The time in seconds to wait after starting tomcat. Defaults to <code>10</code>.\n- server_libs: A hash of Maven GAV coordinate hashes for jars to be placed in the common loader (<path>/common-lib). The key for each hash is defining the filename of the jar. Defaults to <code>{}</code>.\n- common_libs:  Defaults to <code>{}</code>.\n- maven_repository_url: The maven repository to retrieve the server_libs and common_libs jars\n- nexus_url: Set this to the base url of your nexus to use the REST API for artifact resolution. If set this method has precedence to the repository_url attribute. Defaults to <code>nil</code>.\n- nexus_repo: The repo name from which to resolve artifacts. Defaults to <code>\"releases\"</code>.\n- catalina_properties: A hash of properies to append to the `catalina.properties` file Defaults to <code>{}</code>.\n- port_prefix:  Defaults to <code>80</code>.\n- shutdown_port: The port where tomcat listens on shutdown commands. Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- shutdown_wait: The time to wait for tomcat to shut down Defaults to <code>30</code>.\n- shutdown_force: Use -KILL when shutdown_wait threshold is reached. Defaults to <code>false</code>.\n- max_threads: The maximum number of threads for the connector executor pool . Defaults to <code>200</code>.\n- min_threads: The minimum number of threads for the connector executor pool . Defaults to <code>20</code>.\n- http_port: The port tomcat listens on for HTTP requests. Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- ajp_port: The port tomcat listens on for AJP requests. Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- debug: A flag to enable/disable the debug_opts. Defaults to <code>false</code>.\n- debug_opts: The debug options to add to CATALINA_OPTS Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- jvm_route: The route name in case of AJP load balancing.\n- session_timeout: The timeout in minutes to kill sessions. Defaults to <code>60</code>.\n- heap: The maximum memory for the JVM heap space. JVM notation is supported, i.e. 1G or 512m Defaults to <code>\"512m\"</code>.\n- perm: The maximum memory for the JVM perm space. JVM notation is supported, i.e. 1G or 512m Defaults to <code>\"128m\"</code>.\n- catalina_opts: Additional CATALINA_OPTS. Defaults to <code>\"\"</code>.\n- log_dir: The path of the symlink to the logs directory. Set to empty string to not create a link. Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- java_home: The JVM to use. Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- jmx_remote: Flag to enable or disable remote jmx. Defaults to <code>true</code>.\n- jmx_remote_server_name: The host name or ip that resolves to this node. If set to nil, node[:fqdn] will be used. Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- jmx_remote_jar_source: The SHA-256 checksum of the jmx remote jar. Defaults to <code>nil</code>.\n- jmx_remote_jar_source_checksum:  Defaults to <code>nil</code>.\n- jmx_remote_registry_port: The port of the JMX registry. Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- jmx_remote_server_port: The port of the JMX server Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- jmx_remote_use_local_ports: A flag to force local ports to connect to the JMX/RMI server. Defaults to <code>false</code>.\n- jmx_remote_authenticate: A flag to disable jmx authentication. Defaults to <code>true</code>.\n- jmx_remote_ssl: A flag to enable or disable jmx remote over ssl. Defaults to <code>false</code>.\n- jmx_remote_monitor_user: The user for readonly access. Defaults to <code>\"monitor\"</code>.\n- jmx_remote_monitor_password: The password for readonly access. Defaults to <code>\"monitor\"</code>.\n- jmx_remote_control_user: The user for readwrite access. Defaults to <code>\"control\"</code>.\n- jmx_remote_control_password: The password for readwrite access. Defaults to <code>\"control\"</code>.\n- context_config: A hash to pass to the context_template. See context section for the possible configuration keys in the default template. Defaults to <code>{}</code>.\n- context_template: The template name from which to create the context_file. Defaults to <code>\"context.xml.erb\"</code>.\n- context_template_cookbook: The cookbook, from which to load the context_template. Defaults to <code>\"coremedia_tomcat\"</code>.\n- clean_log_dir_on_start: Set this to true to clean the log directory on before starting tomcat Defaults to <code>false</code>.\n- access_log: A toggle to switch on/off access logs Defaults to <code>true</code>.\n- keep_old_instances: A toggle to clean up old tomcat istallations Defaults to <code>false</code>.\n\n### Service Hooks\nIf you want to execute some scripts before or after Tomcat is started/stopped, you may place arbitrary scripts below\nthe `service-hooks` directory. To be picked up, the scripts must be named according to the regular expression\n`<PHASE>.*.sh`,where `<PHASE>` may be either `pre-start`, `post-start`, `pre-stop` or `post-stop`.\nIn order for the scripts to be executed in a certain order, you should prefix the phase with an alphanumeric element i.e.\n`pre-start-01.sh`.\n\n### Port Schema\nIf you set the `port_prefix` attribute, all ports and the debug_opts, which include a port will automatically be preset\nwith the following port schema. All ports can of course be set individually.\n\n`<3-digit prefix><2-digit suffix>`\n\n2-digit suffix\n* `05` - SHUTDOWN\n* `06` - JDWP Debug port will be used in debug_opts default, i.e. `-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8006`\n* `09` - AJP\n* `43` - HTTPS\n* `80` - HTTP\n* `99` - JMX Registry\n* `98` - JMX Server\n\n### Examples\n\n```ruby\ncoremedia_tomcat 'solr' do\n  path '/opt/solr'\n  version '7.0.63'\n  user 'solr'\n  group 'tomcat'\n  port_prefix 88\n  shutdown_wait 40\n  shutdown_force false\n  debug true\n  server_libs('slf4j-api.jar' => { 'group_id' => 'org.slf4j',\n                                   'artifact_id' => 'slf4j-api',\n                                   'version' => '1.7.6'\n                                   'nexus_repo' => 'central' # optional nexus repo name, that has precendence to the global nexus_repo attribute\n  })\n  log_dir '/var/log/solr'\n  jmx_remote true\n  jmx_remote_server_name node[:fqdn]\n  jmx_remote_jar_source 'URL ot catalina-jmx-remote.jar'\n  jmx_remote_use_local_ports false\n  jmx_remote_authenticate false\n  jmx_remote_monitor_user 'monitor'\n  jmx_remote_monitor_password 'monitor'\n  jmx_remote_control_user  'control'\n  jmx_remote_control_password  'control'\n  jmx_remote_ssl false\nend\n```\n\n@attibute port_prefix An integer which will be used as the prefix for all ports.\n## coremedia_tomcat_webapp\n\n\nInstalls a webapp and optionally adds a `META-INF/context.xml`. Whether the maven war artifact will be downloaded\nor downloaded, exploded and enriched with the context file, depends upon the path attribute. If it does not end on\n`.war` the artifact will be exploded if not it will just be downloaded. The exploded dir and the archive will be placed side\nby side.\n\nBeside the `install` action there is a second action called update. This is just a helper action to set the `updated_by_last_action`\nstate of this resource to `true`. The idea of this concept, is that the `coremedia_tomcat_service_lifecycle` definition, then\ncan depend on this resources state to decide, whether the service needs to be stopped and the `doc_base` of this war should be\nupdated. Because of this, you should not choose the tomcats `app_base` directory as the target directory for the `install` action.\n\nTo resolve the latest X-SNAPSHOT, RELEASE or LATEST version, you need to set `nexus_url` and `nexus_repo` attributes.\n\n### Actions\n\n- install: Install the webapp in a directory which is not the `app_base` directory of tomcat. Default action.\n- update: Sets the `updated_by_last_action` flag of this resource to `true`.\n\n### Attribute Parameters\n\n- path: The path to the webapp, can be a file or directory path. In the latter case, the war gets exploded.\n- group_id: Maven groupId.\n- artifact_id: Maven artifactId.\n- version: Maven version.\n- classifier: Maven classifier, defaults to not set. Defaults to <code>nil</code>.\n- checksum: The SHA-256 checksum of the artifact. Defaults to <code>nil</code>.\n- maven_repository_url: The Url of the maven repository, supports all protocols of the remote_file resource. Defaults to Maven Central. Defaults to <code>\"http://repo1.maven.org/maven2/\"</code>.\n- nexus_url: Set this to the base url of your nexus to use the REST API for artifact resolution. If set this method has precedence to the repository_url attribute. Defaults to <code>nil</code>.\n- nexus_repo: The repo name from which to resolve artifacts. Defaults to <code>\"releases\"</code>.\n- nexus_username: The user to access a protected nexus. Defaults to <code>nil</code>.\n- nexus_password: The password to access a protected nexus. Defaults to <code>nil</code>.\n- owner: User ownership (linux only), defaults to \"root\". Defaults to <code>\"root\"</code>.\n- group: Group membership (linux only), defaults to \"root\". Defaults to <code>\"root\"</code>.\n- context: The context name under which to deploy the webapp, defaults to the name of the resource\n- context_template: The template name from which to create the context_file (exploded mode only), set to false to skip the creation. Defaults to <code>Lazy Evaluator</code>, see LWRP code for default.\n- context_template_cookbook: The cookbook, from which to load the context_template. Defaults to <code>\"coremedia_tomcat\"</code>.\n- context_config: A hash to pass to the context_template. See [context section](#context-files) for the possible configuration keys in the default template. Defaults to <code>{}</code>.\n\n### Examples\n\n```ruby\ncoremedia_tomcat_webapp \"/some/path/my-app do\n  group_id 'org.myorg'\n  artifact_id 'my-app'\n  version '1.0.0'\n  context 'myapp'\n  context_config(\n    :display_name => 'myapp',\n    :env_entries => {\n      'toggle' => {\n        'description' => 'this does nothing',\n        'value' => 'false',\n        'type'  => 'java.lang.Boolean'\n      }\n    },\n   :parameter => {\n     'key1' => 'value1',\n     'key2' => 'value2'\n   },\n   :resource_links => {\n     'resourceLinkName' => {\n        'description' => 'does nothing',\n        'value' => 'resourceLinkValue',\n        # defaults to java.lang.String if not set\n        'type' => 'java.lang.String'\n     }\n   }\n )\n  owner 'tomcat'\n  group 'tomcat'\nend\n```\n\n# Author\n\nAuthor:: Felix Simmendinger (<felix.simmendinger@coremedia.com>)\n",
  "maintainer": "Felix Simmendinger",
  "maintainer_email": "felix.simmendinger@coremedia.com",
  "license": "Copyright (C) 2014, CoreMedia AG proprietary License, all rights reserved.\n",
  "platforms": {
    "redhat": ">= 0.0.0",
    "centos": ">= 0.0.0"
  },
  "dependencies": {
    "coremedia_maven": "~> 2.0",
    "ulimit": "~> 0.3"
  },
  "recommendations": {

  },
  "suggestions": {

  },
  "conflicting": {

  },
  "providing": {

  },
  "replacing": {

  },
  "attributes": {

  },
  "groupings": {

  },
  "recipes": {

  },
  "version": "2.2.0",
  "source_url": "https://github.com/coremedia-contributions/coremedia-tomcat-cookbook",
  "issues_url": "https://support.coremedia.com",
  "privacy": false,
  "chef_versions": [

  ],
  "ohai_versions": [

  ],
  "gems": [

  ]
}
